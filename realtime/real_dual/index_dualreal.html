<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>リアルタイム Mocopi Skeleton Viewer (2体) + 角度計測</title>
  <link rel="stylesheet" href="../index_realtime.css" />
</head>
<body>
  <!-- ======UI（コントロールパネル）====== -->
  <div id="controls">
    <!-- WebSocket接続先 -->
    <div class="muted">WebSocket先: <span id="wsUrlLabel">ws://192.168.11.5:8080</span></div>
    <button class="pill" id="reconnectBtn">再接続</button>
    <label class="row muted"><input type="checkbox" id="lockRootPos"> 2体とも root位置を固定</label>

    <!-- 録画関連 -->
    <button class="pill" id="toggleRecordBtn">データを保存する</button>
    <div class="muted" id="recordStatus">録画: 停止中</div>

    <!-- 録画終了後にだけ表示する保存先選択 -->
    <div id="saveChoice" style="display:none; gap:6px; flex-direction:column;">
      <div class="muted">どこに保存しますか？</div>
      <div class="row">
        <button class="pill" data-save="client">クライアント</button>
        <button class="pill" data-save="server">サーバ</button>
        <button class="pill" data-save="both">両方</button>
      </div>
    </div>
  </div>

  <!-- ======UI（メニュー）====== -->
  <div id="menu">
    <button class="menu-toggle" id="menuBtn">☰</button>
    <div id="menuContent" class="menu-content">
      <div class="muted">角度(°)は以下の3種類を一括表示します</div>

      <label>ボーン選択（角度を表示/記録）</label>
      <select id="boneSelect"></select>

      <div style="margin:6px 0 8px;">現在の角度（選択したアバター）</div>
      <div class="angle-line"><span class="angle-name">Total（合成角）</span><span id="angleNowTotal" class="angle-value">-°</span></div>
      <div class="angle-line"><span class="angle-name">Twist（ひねり角・厳密分解）</span><span id="angleNowTwist" class="angle-value">-°</span></div>
      <div class="angle-line"><span class="angle-name">Relative（親に対する角）</span><span id="angleNowRelative" class="angle-value">-°</span></div>

      <hr style="border-color:#555; margin:10px 0;">

      <div class="row">
        <label class="grow"><input type="checkbox" id="showChart"> グラフ表示</label>
        <button class="pill" id="resetChartBtn">リセット</button>
        <button class="pill" id="stopChartBtn">記録停止</button>
      </div>
      <div class="row">
        <label class="grow"><input type="checkbox" id="plotTotal" checked> Total を描画</label>
        <label class="grow"><input type="checkbox" id="plotTwist" checked> Twist を描画</label>
        <label class="grow"><input type="checkbox" id="plotRelative" checked> Relative を描画</label>
      </div>

      <hr style="border-color:#555; margin:10px 0;">

      <label>WebSocket URL</label>
      <input type="text" id="wsUrl" value="ws://192.168.11.5:8080" />
      <button class="pill" id="applyWsUrlBtn">URL 反映</button>

      <!-- === アバターごとのポート選択 === -->
      <hr style="border-color:#555; margin:10px 0;">
      <div class="muted">アバターごとのUDPポート割り当て</div>

      <label>アバターA の UDPポート</label>
      <select id="avatar1Port">
        <option value="12351">12351</option>
        <option value="12352">12352</option>
        <option value="12353">12353（予備）</option>
      </select>

      <label>アバターB の UDPポート</label>
      <select id="avatar2Port">
        <option value="12352">12352</option>
        <option value="12351">12351</option>
        <option value="12353">12353（予備）</option>
      </select>

      <label>角度計測対象アバター</label>
      <select id="angleTargetAvatar">
        <option value="1">アバターA</option>
        <option value="2">アバターB</option>
      </select>

      <hr style="border-color:#555; margin:10px 0;">
      <div class="muted">表示オプション</div>
      <label class="row"><input type="checkbox" id="showLocalAxes"> 選択ボーンのローカル軸を表示</label>
      <label class="row"><input type="checkbox" id="showRedDots" checked> 関節に赤点を表示</label>
      <label class="row"><input type="checkbox" id="showSkeletonLines" checked> スケルトン線を表示</label>

      <hr>
      <div class="row">
        <button class="pill" onclick="location.href='real_vrm/index_vrmrealtime.html'">キャラクターを被せる→</button>
      </div>
      <hr>
      <div class="row">
        <button class="pill" onclick="location.href='../howtouse/instructions/instruction_ondemand.html'">使い方を見る→</button>
      </div>

    </div>
  </div>

  <!-- ======UI（角度グラフ領域）====== -->
  <div id="angleChartWrap">
    <canvas id="angleChart" width="900" height="240"></canvas>
  </div>

  <!-- ======外部スクリプト====== -->
  <script src="../../assets/libs/three.min.js"></script>
  <script src="../../assets/libs/OrbitControls.js"></script>
  <script src="../../assets/libs/SkeletonHelper.js"></script>
  <script src="../../assets/libs/chart.js"></script>

  <!--ここからJavaScript-->
  <script src="index_dualreal.js"></script>
</body>
</html>
